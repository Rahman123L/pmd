<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Multiple File Upload</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.10.3/dist/cdn.min.js" defer></script>
</head>
<body>
    <div x-data="dynamicFileInputs()">
        <form @submit.prevent="submitForm">
            <!-- Loop to generate dynamic file inputs -->
            <template x-for="(file, index) in files" :key="index">
                <div class="file-input">
                    <input type="file" @change="validateFile($event, index)" />
                    <p x-text="errorMessages[index]" class="error-message" style="color: red;"></p>
                    <button type="button" @click="removeFileInput(index)">Remove</button>
                </div>
            </template>

            <button type="button" @click="addFileInput">Add File</button>

            <!-- Submit Button -->
            <button type="submit" :disabled="!allValid">Submit</button>
        </form>
    </div>

    <script>
        function dynamicFileInputs() {
            return {
                files: [null], // array to store file data
                errorMessages: [''], // array to store error messages
                allValid: false,

                addFileInput() {
                    this.files.push(null); // add another file input
                    this.errorMessages.push(''); // add empty error message slot
                },

                removeFileInput(index) {
                    this.files.splice(index, 1); // remove the specific file input
                    this.errorMessages.splice(index, 1); // remove corresponding error message
                    this.checkAllValid(); // check if all remaining inputs are valid
                },

                validateFile(event, index) {
                    const file = event.target.files[0];
                    const maxSizeInMB = 5;
                    const allowedFormat = 'application/pdf';

                    // Reset previous errors
                    this.errorMessages[index] = '';

                    // Validate format
                    if (file && file.type !== allowedFormat) {
                        this.errorMessages[index] = 'File must be in PDF format.';
                        this.files[index] = null; // mark file as invalid
                        this.checkAllValid();
                        return;
                    }

                    // Validate size
                    if (file && file.size > maxSizeInMB * 1024 * 1024) {
                        this.errorMessages[index] = 'File size must be less than 5MB.';
                        this.files[index] = null; // mark file as invalid
                        this.checkAllValid();
                        return;
                    }

                    // If valid, store file and clear error
                    this.files[index] = file;
                    this.errorMessages[index] = '';
                    this.checkAllValid();
                },

                checkAllValid() {
                    this.allValid = this.files.every(file => file !== null); // check if all files are valid
                },

                submitForm() {
                    if (this.allValid) {
                        alert("All files are valid and ready for upload!");
                        // Handle form submission logic here
                    }
                }
            };
        }
    </script>
</body>
</html>